<?php

use GuzzleHttp\Promise\PromiseInterface;

function meteor_finalize_wait(PromiseInterface $promise) {
  $promise->wait(TRUE);
}

function meteor_notify($delay) {
  $path = $delay ? 'updateUserDeferred' : 'updateUser';

  /** @var \GuzzleHttp\Client $client */
  $client = \Drupal::service('http_client');
  $promise = $client->getAsync('http://drop8:3000/' . $path);
  drupal_register_shutdown_function(function () use ($promise) {
    meteor_finalize_wait($promise);
  });
}

/**
 * Implements hook_user_logout().
 */
function meteor_user_logout($account) {
  meteor_notify(0);
}

/**
 * Implements hook_user_login().
 */
function meteor_user_login($account) {
  /** @var \GuzzleHttp\Client $client */
  meteor_notify(1000);
}
